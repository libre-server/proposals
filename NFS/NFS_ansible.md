# Ansible Documentation for NFS Server

## Synopsis
This module controls what filesystem paths are shared remotely by the NFS server.

| Parameter       | Required | Default | Choices                                                                       | Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------|----------|---------|-------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| clear_all       | no       | yes     |  <ul><li>yes</li> <li>no</li> </ul>                                           | Clears all active NFS shares. If `yes`, the only other option to have an effect is `state`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| state           | yes      |         |  <ul><li>present</li> <li>absent</li> <li>shared</li> <li>unshared</li> </ul> |  <ul><li>`present` indicates that the configuration will be updated to make the share indicated by `local_path` available, but the NFS daemon will not apply the configuration change immediately. This is useful when queuing multiple changes to take effect together. Not valid when specifying `clear_all`</li>  <li>`absent` indicates that the configuration will be updated to ensure that the share referenced by `local_path` (or all shares, in the case of `clear_all`) will no longer be available, but the NFS daemon will not apply the configuration change immediately. This is useful when queuing multiple changes to take effect together.</li>  <li> `shared` indicates that the configuration will be updated to make this share available and the NFS daemon will apply the change immediately. Not valid when specifying `clear_all`</li>  <li> `unshared` indicates that the configuration will be updated to make this share (or all shares, in the case of `clear_all`) unavailable immediately.</li> </ul> |
| local_path      | no       |         |                                                                               | Path on the NFS server system to be made available as a network share. Required if `clear_all` is `no`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| remote_path     | no       |         |                                                                               | Path visible for mounting by NFS clients. If unspecified, this is identical to local_path.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| permissions     | no       | ro      | <ul> <li>ro</li> <li>rw</li>  </ul>                                           | Permissions for the NFS share, either read-only (`ro`) or read-write (`rw`). Note: this applies globally to the share; individual files and directories on the share will have their own permissions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| root_squash     | no       | yes     | <ul> <li>yes</li> <li>no</li> </ul>                                           | Whether this server should treat the remote root user as if it was a non-privileged anonymous user. If `no`, the remot root user will be treated as the local root user. /It is recommended not to disable this/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| all_squash      | no       | no      | <ul> <li>yes</li> <li>no</li>  </ul>                                          | Whether this NFS share should treat all remote users as the non-privileged anonymous user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| security        | no       |         | <ul> <li>sys</li> <li>krb5</li> <li>krb5i</li> <li>krb5p</li>  </ul>          |  The options below are listed in increasing order of both security and performance overhead.<ul> <li>`sys`:  No cryptographic security.</li> <li>`krb5`: Use Kerberos for validating user identities.</li> <li>`krb5i`: Use Kerberos for validating user identities and ensuring message integrity.</li> <li>`krb5p`: Use Kerberos for validating user identities, message integrity and fully encrypted communication for privacy.</li>  </ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| allowed_clients | no       | *       |                                                                               | See [exports(5)](https://www.mankier.com/5/exports) for the format to use here                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| options         | no       |         |                                                                               | Special options for this share. See [exports(5)](https://www.mankier.com/5/exports) for details.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |


## Assumptions and simplifications
* I chose to make the assumption that all `allowed_clients` would be expected to have the same permissions and options. If this is not an appropriate assumption, then we may need to ensure that the module will treat (local_path,allowed_clients) as a tuple and combine them appropriately in the resulting configuration.
* I simplified the configuration of `sec=`. The assumption will be that the selected choice will be the only security method permitted for this share.

## Missing pieces
* Support for idmapd options. I don't know this well enough and could use some help. It may also make sense for this to be a separate Ansible module, as it shares little with the configuration of shares.

## Open Questions
* I don't like the option names for `state`, but I couldn't come up with better ones. Suggestions welcome.
* `remote_path` is in there as a future-compatible option; in the container world, we may have the ability to "fake" the mount point to the client, so I added that as an option here. I'm not sure whether to keep it or drop it.
